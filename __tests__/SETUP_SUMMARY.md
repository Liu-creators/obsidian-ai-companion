# æµ‹è¯•æ¡†æ¶é…ç½®æ€»ç»“

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. å®‰è£…ä¾èµ–åŒ…

å·²å®‰è£…ä»¥ä¸‹æµ‹è¯•ç›¸å…³çš„ npm åŒ…ï¼š

- **jest** - å•å…ƒæµ‹è¯•æ¡†æ¶
- **@types/jest** - Jest çš„ TypeScript ç±»å‹å®šä¹‰
- **ts-jest** - Jest çš„ TypeScript é¢„å¤„ç†å™¨
- **fast-check** - å±æ€§æµ‹è¯•åº“ï¼ˆè‡ªå¸¦ç±»å‹å®šä¹‰ï¼‰

### 2. é…ç½®æ–‡ä»¶

#### jest.config.js
- âœ… é…ç½® ts-jest é¢„è®¾
- âœ… è®¾ç½®æµ‹è¯•ç¯å¢ƒä¸º Node.js
- âœ… é…ç½®æµ‹è¯•æ–‡ä»¶åŒ¹é…æ¨¡å¼ï¼ˆ`.test.ts` å’Œ `.spec.ts`ï¼‰
- âœ… é…ç½®æ¨¡å—è·¯å¾„æ˜ å°„ï¼ˆä¸ tsconfig.json ä¿æŒä¸€è‡´ï¼‰
- âœ… é…ç½®è¦†ç›–ç‡æ”¶é›†å’ŒæŠ¥å‘Š
- âœ… è®¾ç½®è¦†ç›–ç‡é˜ˆå€¼ï¼ˆå¼€å‘åˆæœŸä¸º 0%ï¼Œç›®æ ‡ 80%ï¼‰
- âœ… é…ç½®æµ‹è¯•è®¾ç½®æ–‡ä»¶ï¼ˆsetup.tsï¼‰
- âœ… æ’é™¤éæµ‹è¯•æ–‡ä»¶ï¼ˆsetup.ts, test-utils.ts, __mocks__/ï¼‰

#### package.json
æ·»åŠ äº†ä»¥ä¸‹æµ‹è¯•è„šæœ¬ï¼š
- `npm test` - è¿è¡Œæ‰€æœ‰æµ‹è¯•
- `npm run test:watch` - ç›‘å¬æ¨¡å¼
- `npm run test:coverage` - ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
- `npm run test:verbose` - è¯¦ç»†è¾“å‡ºæ¨¡å¼

#### .gitignore
æ·»åŠ äº†æµ‹è¯•ç›¸å…³çš„å¿½ç•¥è§„åˆ™ï¼š
- `coverage/` - è¦†ç›–ç‡æŠ¥å‘Šç›®å½•
- `*.lcov` - è¦†ç›–ç‡æ•°æ®æ–‡ä»¶
- `.jest/` - Jest ç¼“å­˜ç›®å½•

### 3. Mock å¯¹è±¡

#### __mocks__/obsidian.ts
åˆ›å»ºäº†å®Œæ•´çš„ Obsidian API mock å¯¹è±¡ï¼ŒåŒ…æ‹¬ï¼š

**æ ¸å¿ƒç±»**ï¼š
- `Plugin` - æ’ä»¶åŸºç±»
- `PluginSettingTab` - è®¾ç½®é¢æ¿åŸºç±»
- `EditorSuggest` - ç¼–è¾‘å™¨å»ºè®®åŸºç±»
- `Notice` - é€šçŸ¥ç±»
- `Setting` - è®¾ç½®é¡¹ç±»

**UI ç»„ä»¶**ï¼š
- `ButtonComponent` - æŒ‰é’®ç»„ä»¶
- `TextComponent` - æ–‡æœ¬è¾“å…¥ç»„ä»¶
- `TextAreaComponent` - æ–‡æœ¬åŒºåŸŸç»„ä»¶
- `ToggleComponent` - å¼€å…³ç»„ä»¶
- `DropdownComponent` - ä¸‹æ‹‰èœå•ç»„ä»¶
- `SliderComponent` - æ»‘å—ç»„ä»¶

**æ¥å£å’Œç±»å‹**ï¼š
- `Editor` - ç¼–è¾‘å™¨æ¥å£
- `App` - åº”ç”¨æ¥å£
- `Workspace` - å·¥ä½œåŒºæ¥å£
- `Vault` - æ–‡ä»¶åº“æ¥å£
- `MetadataCache` - å…ƒæ•°æ®ç¼“å­˜æ¥å£
- `FileManager` - æ–‡ä»¶ç®¡ç†å™¨æ¥å£
- `TFile` / `TFolder` / `TAbstractFile` - æ–‡ä»¶ç±»å‹
- `EditorPosition` - ç¼–è¾‘å™¨ä½ç½®
- `EditorSuggestTriggerInfo` - å»ºè®®è§¦å‘ä¿¡æ¯
- `Command` - å‘½ä»¤æ¥å£
- ä»¥åŠæ›´å¤š...

**Mock åˆ›å»ºå‡½æ•°**ï¼š
- `createMockApp()` - åˆ›å»º App mock
- `createMockWorkspace()` - åˆ›å»º Workspace mock
- `createMockVault()` - åˆ›å»º Vault mock
- `createMockMetadataCache()` - åˆ›å»º MetadataCache mock
- `createMockFileManager()` - åˆ›å»º FileManager mock
- `createMockEditor(content)` - åˆ›å»º Editor mock
- `createMockTFile(path)` - åˆ›å»º TFile mock

### 4. æµ‹è¯•å·¥å…·å‡½æ•°

#### __tests__/test-utils.ts
æä¾›äº†ä¸°å¯Œçš„æµ‹è¯•è¾…åŠ©å‡½æ•°ï¼š

**å¯¹è±¡åˆ›å»º**ï¼š
- `createTestPlugin(manifest?)` - åˆ›å»ºæµ‹è¯•æ’ä»¶
- `createTestEditor(content?)` - åˆ›å»ºæµ‹è¯•ç¼–è¾‘å™¨
- `createTestFile(path?)` - åˆ›å»ºæµ‹è¯•æ–‡ä»¶
- `createTestApp()` - åˆ›å»ºæµ‹è¯•åº”ç”¨
- `createPosition(line, ch)` - åˆ›å»ºç¼–è¾‘å™¨ä½ç½®

**å¼‚æ­¥å·¥å…·**ï¼š
- `wait(ms)` - ç­‰å¾…æŒ‡å®šæ—¶é—´
- `waitFor(condition, timeout?, interval?)` - ç­‰å¾…æ¡ä»¶æ»¡è¶³
- `simulateNetworkDelay(ms?)` - æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ

**äº‹ä»¶æ¨¡æ‹Ÿ**ï¼š
- `createKeyboardEvent(key, options?)` - åˆ›å»ºé”®ç›˜äº‹ä»¶
- `createMouseEvent(type?, options?)` - åˆ›å»ºé¼ æ ‡äº‹ä»¶

**éšæœºæ•°æ®ç”Ÿæˆ**ï¼š
- `randomString(length?)` - éšæœºå­—ç¬¦ä¸²
- `randomNumber(min?, max?)` - éšæœºæ•°å­—
- `randomBoolean()` - éšæœºå¸ƒå°”å€¼

**æµ‹è¯•æ•°æ®ç”Ÿæˆå™¨**ï¼š
- `TestDataGenerator.markdown(options)` - ç”Ÿæˆ Markdown å†…å®¹
- `TestDataGenerator.apiResponse(content)` - ç”Ÿæˆ API å“åº”
- `TestDataGenerator.error(type, message)` - ç”Ÿæˆé”™è¯¯å¯¹è±¡

**Console æ•è·**ï¼š
- `ConsoleCapture` ç±» - æ•è·å’ŒéªŒè¯ console è¾“å‡º

**æ–­è¨€è¾…åŠ©**ï¼š
- `Assertions.stringContains()` - å­—ç¬¦ä¸²åŒ…å«æ–­è¨€
- `Assertions.stringMatches()` - æ­£åˆ™åŒ¹é…æ–­è¨€
- `Assertions.arrayContains()` - æ•°ç»„åŒ…å«æ–­è¨€
- `Assertions.arrayLength()` - æ•°ç»„é•¿åº¦æ–­è¨€
- `Assertions.objectHasProperty()` - å¯¹è±¡å±æ€§æ–­è¨€
- `Assertions.throws()` - å¼‚å¸¸æ–­è¨€
- `Assertions.asyncThrows()` - å¼‚æ­¥å¼‚å¸¸æ–­è¨€

**Mock ç®¡ç†**ï¼š
- `createMockFunction()` - åˆ›å»º mock å‡½æ•°
- `expectCalled()` - éªŒè¯è°ƒç”¨
- `expectNotCalled()` - éªŒè¯æœªè°ƒç”¨
- `expectCalledWith()` - éªŒè¯è°ƒç”¨å‚æ•°
- `resetAllMocks()` - é‡ç½®æ‰€æœ‰ mock

### 5. æµ‹è¯•è®¾ç½®æ–‡ä»¶

#### __tests__/setup.ts
- âœ… é…ç½®å…¨å±€æµ‹è¯•è¶…æ—¶æ—¶é—´ï¼ˆ10 ç§’ï¼‰
- âœ… é¢„ç•™ console è¾“å‡ºé…ç½®ä½ç½®
- âœ… é¢„ç•™è‡ªå®šä¹‰åŒ¹é…å™¨æ‰©å±•ä½ç½®

### 6. ç¤ºä¾‹æµ‹è¯•

#### __tests__/example.test.ts
åˆ›å»ºäº†å®Œæ•´çš„ç¤ºä¾‹æµ‹è¯•ï¼ŒåŒ…æ‹¬ï¼š

**å•å…ƒæµ‹è¯•ç¤ºä¾‹**ï¼š
- Jest åŸºæœ¬åŠŸèƒ½éªŒè¯
- æµ‹è¯•å·¥å…·å‡½æ•°éªŒè¯
- Mock å¯¹è±¡åˆ›å»ºéªŒè¯
- æ•°æ®ç”Ÿæˆå™¨éªŒè¯
- æ–­è¨€è¾…åŠ©å‡½æ•°éªŒè¯

**å±æ€§æµ‹è¯•ç¤ºä¾‹**ï¼š
- å­—ç¬¦ä¸²è¿æ¥å±æ€§æµ‹è¯•
- æ•°ç»„åè½¬å±æ€§æµ‹è¯•
- åŠ æ³•äº¤æ¢å¾‹å±æ€§æµ‹è¯•

æ‰€æœ‰æµ‹è¯•éƒ½é€šè¿‡ âœ…

### 7. æ–‡æ¡£

#### __tests__/README.md
åˆ›å»ºäº†è¯¦ç»†çš„æµ‹è¯•æ¡†æ¶ä½¿ç”¨æŒ‡å—ï¼ŒåŒ…æ‹¬ï¼š
- ç›®å½•ç»“æ„è¯´æ˜
- è¿è¡Œæµ‹è¯•çš„å„ç§æ–¹å¼
- å•å…ƒæµ‹è¯•ç¼–å†™ç¤ºä¾‹
- å±æ€§æµ‹è¯•ç¼–å†™ç¤ºä¾‹
- æµ‹è¯•å·¥å…·å‡½æ•°ä½¿ç”¨è¯´æ˜
- Mock å¯¹è±¡ä½¿ç”¨è¯´æ˜
- æµ‹è¯•è¦†ç›–ç‡è¯´æ˜
- æœ€ä½³å®è·µ
- è°ƒè¯•æŠ€å·§
- å¸¸è§é—®é¢˜è§£ç­”
- å‚è€ƒèµ„æº

## ğŸ“Š æµ‹è¯•éªŒè¯ç»“æœ

```
âœ“ æ‰€æœ‰ä¾èµ–åŒ…å®‰è£…æˆåŠŸ
âœ“ Jest é…ç½®æ­£ç¡®
âœ“ TypeScript ç¼–è¯‘æ­£å¸¸
âœ“ Mock å¯¹è±¡å·¥ä½œæ­£å¸¸
âœ“ æµ‹è¯•å·¥å…·å‡½æ•°å·¥ä½œæ­£å¸¸
âœ“ å•å…ƒæµ‹è¯•è¿è¡ŒæˆåŠŸï¼ˆ12/12 é€šè¿‡ï¼‰
âœ“ å±æ€§æµ‹è¯•è¿è¡ŒæˆåŠŸï¼ˆ100+ æ¬¡è¿­ä»£ï¼‰
âœ“ è¦†ç›–ç‡æŠ¥å‘Šç”Ÿæˆæ­£å¸¸
```

## ğŸ¯ ä¸‹ä¸€æ­¥

æµ‹è¯•æ¡†æ¶å·²å®Œå…¨é…ç½®å®Œæˆï¼Œå¯ä»¥å¼€å§‹ä¸ºå®é™…åŠŸèƒ½ç¼–å†™æµ‹è¯•ï¼š

1. **ä»»åŠ¡ 2.4** - ç¼–å†™è®¾ç½®ç®¡ç†å™¨çš„å±æ€§æµ‹è¯•
2. **ä»»åŠ¡ 2.5** - ç¼–å†™è®¾ç½®ç®¡ç†å™¨çš„å•å…ƒæµ‹è¯•
3. **ä»»åŠ¡ 3.4** - ç¼–å†™ AI å®¢æˆ·ç«¯çš„å±æ€§æµ‹è¯•
4. **ä»»åŠ¡ 3.5** - ç¼–å†™ ResponseParser çš„å±æ€§æµ‹è¯•
5. **ä»»åŠ¡ 3.6** - ç¼–å†™ AI å®¢æˆ·ç«¯çš„å•å…ƒæµ‹è¯•
6. ä»¥åŠåç»­æ‰€æœ‰æµ‹è¯•ä»»åŠ¡...

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **è¦†ç›–ç‡é˜ˆå€¼**ï¼šå½“å‰è®¾ç½®ä¸º 0% ä»¥ä¸é˜»å¡å¼€å‘ï¼Œåœ¨åŠŸèƒ½å®Œæˆååº”é€æ­¥æå‡åˆ° 80%
2. **å±æ€§æµ‹è¯•è¿­ä»£æ¬¡æ•°**ï¼šæ¯ä¸ªå±æ€§æµ‹è¯•è‡³å°‘è¿è¡Œ 100 æ¬¡ï¼ˆå·²åœ¨è®¾è®¡æ–‡æ¡£ä¸­è¦æ±‚ï¼‰
3. **æµ‹è¯•æ–‡ä»¶å‘½å**ï¼šä½¿ç”¨ `.test.ts` æˆ– `.spec.ts` åç¼€
4. **æµ‹è¯•æè¿°**ï¼šä½¿ç”¨ä¸­æ–‡æè¿°æµ‹è¯•æ„å›¾
5. **Mock æ¸…ç†**ï¼šåœ¨ `afterEach` ä¸­æ¸…ç† mock ä»¥é¿å…æµ‹è¯•é—´å¹²æ‰°

## ğŸ”§ å¯ç”¨å‘½ä»¤

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test

# ç›‘å¬æ¨¡å¼ï¼ˆå¼€å‘æ—¶æ¨èï¼‰
npm run test:watch

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm run test:coverage

# è¯¦ç»†è¾“å‡ºæ¨¡å¼
npm run test:verbose
```

## ğŸ“š å‚è€ƒæ–‡æ¡£

- [Jest é…ç½®æ–‡æ¡£](jest.config.js)
- [æµ‹è¯•ä½¿ç”¨æŒ‡å—](__tests__/README.md)
- [Obsidian API Mock](__mocks__/obsidian.ts)
- [æµ‹è¯•å·¥å…·å‡½æ•°](__tests__/test-utils.ts)
- [ç¤ºä¾‹æµ‹è¯•](__tests__/example.test.ts)
